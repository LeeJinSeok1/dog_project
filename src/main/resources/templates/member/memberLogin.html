<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>memberLogin</title>
  <link rel="stylesheet" th:href="@{/css/bootstrap.rtl.min.css}">
  <script th:src="@{/js/jqurey.js}"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Dongle:wght@300&display=swap');
    /* 폰트 적용 */
    body {
      font-family: 'Dongle', sans-serif;
      font-size: 30px;
    }
    #memberLoginForm{
      margin-left: auto;
      margin-right: auto;
      margin-top: 200px;
      font-size:30px;
      width: 500px;
      height: 350px;
    }
  </style>
</head>
<body>
<th:block th:replace="header/header :: header"></th:block>
<div class="container mt-5">
  <form action="/memberLogin" method="post" class="form-control" id="memberLoginForm" name="memberLoginForm" >
    이메일 입력
    <input type="text" class="form-control" placeholder="이메일을 입력해주세요!" name="memberEmail" id="email">
    <br>
    비밀번호 입력
    <input type="text" class="form-control" placeholder="비밀번호를 입력해주세요!" name="memberPass" id="pass">
    <br>
    <input type="button" class="btn btn-dark" value="로그인" onclick="memberLogin()" style="float: right;">
  </form>
</div>

<div id="kakao">

</div>

<!--카카오-->
<div>
  <ul>
    <li onclick="kakaoLogin();">
      <a href="javascript:void(0)">
        <span>카카오 로그인</span>
      </a>
    </li>
    <li onclick="kakaoLogout();">
      <a href="javascript:void(0)">
        <span>카카오 로그아웃</span>
      </a>
    </li>
  </ul>
  <!-- 카카오 스크립트 -->
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    Kakao.init('4c01cd21dea3f297e5d486eab7cee559'); //발급받은 키 중 javascript키를 사용해준다.
    console.log(Kakao.isInitialized()); // sdk초기화여부판단
    //카카오로그인
    function kakaoLogin() {
      Kakao.Auth.login({
        success: function (response) {
          console.log(response)
          Kakao.API.request({
            url: '/v2/user/me',
            success: function (account) {

              console.log(account)
              const member = account.kakao_account.email;
              window.location.href="kakaoLogin?memberEmail="+member;

            },
            fail: function (error) {
              console.log(error)
            },
          })
        },
        fail: function (error) {
          console.log(error)
        },
      })
    }
    //카카오로그아웃
    function kakaoLogout() {
      if (Kakao.Auth.getAccessToken()) {
        Kakao.API.request({
          url: '/v1/user/unlink',
          success: function (response) {
            console.log(response)
          },
          fail: function (error) {
            console.log(error)
          },
        })
        Kakao.Auth.setAccessToken(undefined)
      }
    }
  </script>
</div>
<span id="kakaoEmail">

</span>

<div>
  <div class="container mt-5" >
    <footer class="py-3 my-4">
      <ul class="nav justify-content-center border-bottom pb-3 mb-3" style="margin-top: 300px">
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">입양소식</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">입양신청</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">분양등록</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">임시보호 소식</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">친구를 찾아요</a></li>
      </ul>
      <p class="text-center text-muted">2022 JinSeok Project </p>
    </footer>
  </div>
</div>

</body>
<!-- 카카오 스크립트 -->


<script>
  const memberLogin = () => {
    const email = document.getElementById("email").value;
    const pass =document.getElementById("pass").value;
    $.ajax({
      type: "post",
      url: "/memberLoginCk",
      data: {
        memberEmail: email,
        memberPass: pass
      },
      dateType: "text",
      success: function (ck) {
        if (ck == "ok") {
         document.memberLoginForm.submit();
        }else if(ck=="no"){
          alert("입력하신 정보가 맞지 않습니다.")
        }
      },
      error: function (ck) {

      }
    })

  }

</script>
</html>